\documentclass{article}

\title{Software Reliability -- Coursework 1 \\ Using ESC/Java 2 and Daikon}
\author{Jack Bracewell, Milan Misak, Craig Ellis}
\date{}

\usepackage{float}

\begin{document}

\maketitle

\section{Introduction}

Not sure we need an introduction

\section{ESC/Java}

\subsection{Eliminating ``null'' warnings}

One of the interesting things about this bit is the order of comment annotations.

initially we tried:

\begin{verbatim}
  /* invariant \nonnullelements(seatReservations)
  /*@ non_null */
  private final Customer[][] seatReservations;
\end{verbatim}

This actually created 2 warnings regarding assigning null to fields of seatReservations. It seems that the
\verb|non_null| comment annotation overwrote the invariant annotation. Switching the order to:
\begin{verbatim}
  /*@ non_null */
  /* invariant \nonnullelements(seatReservations)
\end{verbatim}
fixed removed the warnings.

\subsection{Eliminating ``negative length'' warnings}

There were only 2 warnings about negative length.

\begin{verbatim}
  10:  seatReservations = new Customer[rowToIndex(Seat.MAX_ROW) + 1]
  11:                                 [numberToIndex(Seat.MAX_NUMBER) + 1];
\end{verbatim}

This was solved by annotating rowToIndex and numberToIndex as helper functions. ESC Java
will inline the function body, essentially translating the 2 above lines into:
\begin{verbatim}
  10:  seatReservations = new Customer[(Seat.MAX_ROW - Seat.MIN_ROW) + 1]
  11:                                 [(Seat.MAX_NUMBER - Seat.MIN_NUMBER) + 1];
\end{verbatim}

Suprisingly, \verb|(Seat.MAX_ROW - Seat.MIN_ROW) + 1| and \verb|(Seat.MAX_NUMBER - Seat.MIN_NUMBER) + 1| turn
out to be positive numbers. So the warning disappears.

\subsection{Eliminating ``negative array index'' warnings}

These cases were all very similar, and were related to the two fields (row, number) of the Seat class. To solve them, we first gave the getters post-conditions that ensured their values were in an acceptable range (Seat.MIN\_ROW, MAX\_ROW; Seat.MIN\_NUMBER, MAX\_NUMBER). This required two other changes - we made gave invariants to both row and number, and preconditions to their setters. We also made the indexToNumber() and indexToRow() functions into helpers.

\subsection{Eliminating ``index too large'' warnings}

Warnings of this type were eliminated by adding object invariants to the SeatReservationManager class for the seatReservations array. We had to make sure that the first dimension of the array stays within bounds set by \emph{Seat.MIN\_ROW) and \emph{Seat.MAX\_ROW}. We achieved this by adding the following invariant:

\begin{verbatim}
    /*@ invariant seatReservations.length == Seat.MAX_ROW - Seat.MIN_ROW + 1 */
\end{verbatim}

Then, we had to make sure all the arrays within the outer array (second dimension) have a length as calculated from \emph{Seat.MIN\_NUMBER} and \emph{Seat.MAX\_NUMBER}. This involved adding a more elaborate object invariant using forall:

\begin{verbatim}
    /*@ invariant (\forall int x; x >= 0 && x <= seatReservations.length - 1 ==> seatReservations[x].length == Seat.MAX_NUMBER - Seat.MIN_NUMBER + 1) */
\end{verbatim}

TODO: interesting case

\subsection{Eliminating ``array element subtyping'' warnings}

\subsection{Eliminating ``violation of modifies clause'' warnings}

\section{Daikon}

\end{document}
